# Certo Spec
# WARNING: This file is managed by certo. Manual edits may be overwritten.
# Use `certo claim`, `certo issue` to make changes.

[spec]
name = "certo"
version = 1
created = 2026-02-05T14:07:00Z
author = "metaist"

# =============================================================================
# CHECKS
# =============================================================================

[[checks]]
id = "k-spec-exists"
kind = "shell"
cmd = "test -f .certo/spec.toml && head -1 .certo/spec.toml"
matches = ['# Certo Spec']

[[checks]]
id = "k-certo-dir"
kind = "shell"
cmd = "test -d .certo"

[[checks]]
id = "k-check-offline"
kind = "shell"
cmd = "uv run certo check --offline --skip k-check-offline || true"
timeout = 2

[[checks]]
id = "k-kb-dir"
kind = "shell"
cmd = "test -d src/certo/kb/python"

[[checks]]
id = "k-meta-toml"
kind = "shell"
cmd = "test -f src/certo/kb/python/typeshed/meta.toml"

[[checks]]
id = "k-versions-file"
kind = "shell"
cmd = "test -f src/certo/kb/python/typeshed/VERSIONS"

[[checks]]
id = "k-kb-update-source"
kind = "shell"
cmd = "grep -q 'github.com/python/typeshed' src/certo/kb/update.py"

[[checks]]
id = "k-openrouter"
kind = "shell"
cmd = "grep -q 'openrouter.ai' src/certo/llm/provider.py"

[[checks]]
id = "k-test-mirrors-src"
kind = "shell"
cmd = "for d in $(find src/certo -type d); do py_count=$(find \"$d\" -maxdepth 1 -name \"*.py\" ! -name \"__init__.py\" 2>/dev/null | wc -l); if [ \"$py_count\" -gt 0 ]; then test_dir=$(echo \"$d\" | sed \"s|src/certo|test|\"); [ -d \"$test_dir\" ] || exit 1; fi; done"

[[checks]]
id = "k-coverage"
kind = "shell"
cmd = "uv run coverage report --format=total | python3 -c \"import sys; cov=int(sys.stdin.read().strip()); sys.exit(0 if cov >= 98 else 1)\""

[[checks]]
id = "k-ci-versions"
kind = "fact"
has = "python.ci-versions"

[[checks]]
id = "k-cli-docs"
kind = "llm"
files = ['docs/cli.md', 'src/certo/cli/__init__.py']
prompt = "Verify that docs/cli.md documents all CLI commands defined in src/certo/cli/__init__.py"

[[checks]]
id = "k-eol-python"
kind = "url"
url = "https://endoflife.date/api/python.json"
cmd = "OURS=$(grep \"Programming Language :: Python :: 3\\.\" pyproject.toml | grep -oP \"3\\.\\d+\" | jq -R -s -c \"split(\\\"\\\\n\\\") | map(select(. != \\\"\\\"))\"); jq -e --argjson ours \"$OURS\" \"[.[] | select(.eol > (now | strftime(\\\"%Y-%m-%d\\\")))] | map(.cycle) | . as \\$active | \\$ours | all(. as \\$v | \\$active | contains([\\$v]))\""

[[checks]]
id = "k-version-consistency"
kind = "fact"
empty = "python.consistency-issues"

# =============================================================================
# CLAIMS
# =============================================================================

[[claims]]
id = "c-e50e9d4"
text = "Spec files use TOML format"
status = "confirmed"
source = "human"
author = "metaist"
level = "block"
tags = ['format']
created = 2026-02-05T14:07:00Z
why = "TOML is explicit, has no implicit type coercion, no code execution risk"
considered = ['YAML', 'JSON', 'KDL', 'Markdown+frontmatter']

[claims.verify]
"k-spec-exists.passed" = { eq = true }

[[claims]]
id = "c-caf8ac4"
text = "Certo stores its data in .certo/ directory"
status = "confirmed"
source = "human"
author = "metaist"
level = "block"
tags = ['structure']
created = 2026-02-05T14:07:00Z
why = "Dotted because it's tool-managed, like .git"
considered = ['Single file', 'certo/ (not dotted)', 'certo.toml at root']

[claims.verify]
"k-certo-dir.passed" = { eq = true }

[[claims]]
id = "c-b0d1e6d"
text = "All timestamps in spec files use UTC with timezone"
status = "confirmed"
source = "human"
author = "metaist"
level = "warn"
tags = ['format']
created = 2026-02-05T14:45:00Z
why = "TOML natively supports datetime with timezone. UTC avoids ambiguity."
considered = ['Local dates only', 'Unix timestamps']

[[claims]]
id = "c-08f4b1f"
text = "certo check --offline completes in under 2 seconds"
status = "confirmed"
source = "human"
author = "metaist"
level = "warn"
tags = ['performance']
created = 2026-02-05T14:50:00Z
updated = 2026-02-06T06:10:14Z
why = "Developers run checks frequently. Slow checks get disabled or ignored."

[claims.verify]
"k-check-offline.passed" = { eq = true }

[[claims]]
id = "c-e52fcc2"
text = "Knowledge base is bundled with certo package"
status = "confirmed"
source = "human"
author = "metaist"
level = "block"
tags = ['architecture']
created = 2026-02-05T17:00:00Z
why = "We don't know enough about what kinds of knowledge we need yet. Bundling avoids premature schema design."
considered = ['Fetchable to ~/.certo/', 'Separate certo-knowledge package']

[claims.verify]
"k-kb-dir.passed" = { eq = true }

[[claims]]
id = "c-14d95c9"
text = "Knowledge metadata uses TOML format (meta.toml)"
status = "confirmed"
source = "human"
author = "metaist"
level = "warn"
tags = ['format']
created = 2026-02-05T17:00:00Z
why = "TOML is already our standard"
considered = ['JSON', 'YAML']

[claims.verify]
"k-meta-toml.passed" = { eq = true }

[[claims]]
id = "c-b5b9a45"
text = "Python stdlib version data comes from typeshed VERSIONS file"
status = "confirmed"
source = "human"
author = "metaist"
level = "block"
tags = ['knowledge']
created = 2026-02-05T17:00:00Z
why = "Typeshed is already used by pyright, mypy. The VERSIONS file is exactly what we need."
considered = ['Scrape Python docs', 'Maintain our own database']

[claims.verify]
"k-versions-file.passed" = { eq = true }

[[claims]]
id = "c-32260b0"
text = "certo kb update fetches knowledge from authoritative sources"
status = "confirmed"
source = "human"
author = "metaist"
level = "warn"
tags = ['transparency']
created = 2026-02-05T17:00:00Z
why = "Transparency aligns with certo's philosophy. Anyone can audit or reproduce."
considered = ['Hidden scripts', 'Manual curation']

[claims.verify]
"k-kb-update-source.passed" = { eq = true }

[[claims]]
id = "c-14b5f9e"
text = "Claims can use LLM verification via OpenRouter API"
status = "confirmed"
source = "human"
author = "metaist"
level = "warn"
tags = ['verification']
created = 2026-02-05T18:00:00Z
why = "LLMs can handle anything expressible in natural language without upfront work."
considered = ['Static checks only', 'Custom code for each check type']

[claims.verify]
"k-openrouter.passed" = { eq = true }

[[claims]]
id = "c-eb9736a"
text = "Test directory structure mirrors source directory structure"
status = "confirmed"
source = "human"
author = "metaist"
level = "warn"
tags = ['maintainability']
created = 2026-02-05T19:00:00Z
updated = 2026-02-06T04:56:46Z
why = "Mirroring keeps navigation simple"
considered = ['Flat test directory', 'Tests alongside source']

[claims.verify]
"k-test-mirrors-src.passed" = { eq = true }

[[claims]]
id = "c-9f15ff6"
text = "Test coverage is at least 98%"
status = "confirmed"
source = "human"
author = "metaist"
level = "warn"
tags = ['maintainability']
created = 2026-02-05T14:07:00Z
updated = 2026-02-06T06:03:59Z

[claims.verify]
"k-coverage.passed" = { eq = true }

[[claims]]
id = "c-b72253d"
text = "certo runs on all Python versions in CI matrix"
status = "rejected"
source = "human"
author = "metaist"
level = "block"
tags = ['compatibility']
created = 2026-02-05T14:07:00Z
updated = 2026-02-06T04:59:19Z

[[claims]]
id = "c-8d6ceb6"
text = "docs/cli.md documents all CLI commands"
status = "confirmed"
source = "human"
author = "metaist"
level = "warn"
tags = ['documentation']
created = 2026-02-05T14:07:00Z
# verify requires LLM check which is skipped offline

[[claims]]
id = "c-d75a4b4"
text = "All supported Python versions are not end-of-life"
status = "confirmed"
source = "human"
author = "metaist"
level = "block"
tags = ['compatibility']
created = 2026-02-06T04:59:24Z
updated = 2026-02-06T06:07:25Z
why = "Supporting EOL Python versions is a security risk"

[claims.verify]
"k-eol-python.passed" = { eq = true }

[[claims]]
id = "c-8358075"
text = "Python versions are consistent across requires-python, classifiers, and CI matrix"
status = "confirmed"
source = "human"
author = "metaist"
level = "block"
tags = ['compatibility', 'maintainability']
created = 2026-02-06T04:59:28Z
updated = 2026-02-06T05:59:39Z
why = "Inconsistent version declarations cause confusion and missed test coverage"

[claims.verify]
"k-version-consistency.passed" = { eq = true }

[[claims]]
id = "c-b9896c4"
text = "Test suite completes in under 10 seconds"
status = "pending"
source = "human"
level = "warn"
tags = ['performance']
created = 2026-02-06T11:38:22Z
updated = 2026-02-06T11:41:37Z

[[claims]]
id = "c-151faa9"
text = "ds dev completes in under 60 seconds"
status = "confirmed"
source = "human"
level = "warn"
tags = ['performance']
created = 2026-02-06T11:38:43Z
updated = 2026-02-06T11:39:10Z

# =============================================================================
# ISSUES
# =============================================================================

[[issues]]
id = "i-b830f79"
text = "What problem does certo solve?"
status = "closed"
tags = ['vision']
created = 2026-02-05T14:07:00Z
closed_reason = "The verification problem is universalâ€”gap between intent and implementation. AI just made it urgent. Certo addresses both."

[[issues]]
id = "i-b962737"
text = "What kinds of assurance does certo provide?"
status = "closed"
tags = ['vision']
created = 2026-02-05T14:07:00Z
closed_reason = "Multiple types: confidence, proof, auditability, alerting. Strongest available for each statement, explicit about what kind."

[[issues]]
id = "i-cb56f93"
text = "Who are the target users?"
status = "closed"
tags = ['vision']
created = 2026-02-05T14:07:00Z
closed_reason = "In order: (1) metaist building certo, (2) metaist on other projects, (3) technical users, (4) non-technical stakeholders."

[[issues]]
id = "i-2016602"
text = "What's the minimal viable loop?"
status = "closed"
tags = ['bootstrap']
created = 2026-02-05T14:07:00Z
closed_reason = "Parse spec, verify at least one claim. Start with check command, can verify certo with certo immediately."

[[issues]]
id = "i-4fc6f7b"
text = "How should spec content be organized?"
status = "closed"
tags = ['format']
created = 2026-02-05T14:07:00Z
closed_reason = "Narrow-broad-narrow: top-level categories, items within, details in each. Avoids indentation hell and context loss."

[[issues]]
id = "i-8204e03"
text = "How should context overrides work?"
status = "closed"
tags = ['format']
created = 2026-02-05T14:45:00Z
closed_reason = "Structured and nested. modifications = [{ claim = 'c-xxx', action = 'relax' }]. Machine-readable, validates cleanly."

[[issues]]
id = "i-cadb84f"
text = "How do we handle implicit assumptions?"
status = "closed"
tags = ['architecture']
created = 2026-02-05T16:00:00Z
closed_reason = "Track explicitly. certo scan discovers assumptions, check verifies consistency. Enables automated checking."

[[issues]]
id = "i-25434e0"
text = "Which language ecosystems to support?"
status = "closed"
tags = ['scope']
created = 2026-02-05T17:00:00Z
closed_reason = "Start with Python stdlib, extensible to others. Prove the pattern first, don't over-engineer."

[[issues]]
id = "i-6030f3e"
text = "What types belong in the spec?"
status = "closed"
tags = ['format']
created = 2026-02-05T20:00:00Z
closed_reason = "Three types: claims (verifiable statements), issues (questions/decisions), contexts (where rules differ). Everything else is metadata."
